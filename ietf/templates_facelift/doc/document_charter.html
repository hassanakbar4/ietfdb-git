{% extends "ietf.html" %}

{% load ietf_filters %}

{% block title %}{{ doc.canonical_name }}-{{ doc.rev }}{% endblock %}

{% block content %}
{{ top|safe }}

{% include "doc/revisions_list.html" %}

<table class="table table-condensed table-striped">
	<tr>
		<th class="nowrap">
			{% if doc.get_state_slug != "approved" %}
				Proposed charter
			{% else %}
				Charter
			{% endif %}
		</th>
		<td>
			{{ group.name }} {{ group.type.name }}
			(<a href="{{ group.about_url }}">{{ group.acronym }}</a>) {{ group.type.name }}

			{% if snapshot %}
				<span class="label label-warning">Snapshot</span>
			{% endif %}

			<a class="pull-right" href="/feed/group-changes/{{ group.acronym }}/"><span class="fa fa-rss"></span> Atom feed</a>
		</td>
	</tr>

	<tr>
		<th class="nowrap">WG state</th>
		<td>{{ group.state.name }}</td>
	</tr>
	<tr>
		<th class="nowrap"><a href="/doc/help/state/charter/">Charter state</a></th>
		<td>
			{% if not snapshot and can_manage %}
				<a class="btn btn-default btn-xs pull-right" title="{{ doc.get_state.desc }}" href="{% url "charter_change_state" name=doc.name %}">Edit</a>
			{% endif %}
			{{ doc.get_state.name }}

			</a>
			{% if chartering == "initial" %}
				<span class="label label-info">Initial chartering</span>
			{% endif %}
			{% if chartering == "rechartering" %}
				<span class="label label-info">Rechartering</span>
			{% endif %}
		</td>
	</tr>

{% if not snapshot and chartering %}
	<tr>
		<th class="nowrap">Telechat date</th>
		<td>
			{% if can_manage %}
				<a class="btn btn-default btn-xs pull-right" href="{% url "charter_telechat_date" name=doc.name %}">Edit</a>
			{% endif %}
			{% if not telechat %}
				(None)
			{% else %}
				On agenda of {{ telechat.telechat_date|date:"Y-m-d" }} IESG telechat
			{% endif %}

			{% if ballot_summary %}
				<br><i>{{ ballot_summary }}</i>
			{% endif %}
{% endif %}

	<tr>
		<th class="nowrap">Responsible AD</th>
		<td>
			{% if can_manage %}
				<a class="btn btn-default btn-xs pull-right" href="{% url "charter_edit_ad" name=doc.name %}">Edit</a>
			{% endif %}
			{{ doc.ad|default:"(None)" }}
		</td>
	</tr>

	<tr>
		<th class="nowrap">Send notices to</th>
		<td>
			{% if can_manage %}
				<a class="btn btn-default btn-xs pull-right" href="{% url "charter_edit_notify" name=doc.name %}">Edit</a>
			{% endif %}
			{{ doc.notify|default:"(None)" }}
		</td>
	</tr>

	<tr>
		<th class="nowrap">Last updated</th>
		<td>{{ doc.time|date:"Y-m-d" }}</td>
	</tr>
</table>

<p class="buttonlist">
	{% if not snapshot and can_manage %}
		{% if chartering %}
			{% url "charter_startstop_process" name=doc.name option='abandon' as abandon_url %}
			{% if abandon_url %}
				<a class="btn btn-danger" href="{{ abandon_url }}">Abandon chartering</a>
			{% endif %}

		{% if user|has_role:"Secretariat" %}
			{% url "charter_approve" name=doc.name as approve_url %}
			{% if approve_url %}
				<a class="btn btn-warning" href="{{ approve_url }}">Approve charter</a>
			{% endif %}
		{% endif %}

	{% else %}

		{% if group.state_id == "proposed" or group.state_id == "bof" %}
			{% url "charter_submit" name=doc.name option='initcharter' as start_url %}
			{% if start_url %}
				<a class="btn btn-default" href="{{ start_url }}">Start chartering</a>
			{% endif %}
		{% else %}
			{% url "charter_submit" name=doc.name option='recharter' as recharter_url %}
			{% if recharter_url %}
				<a class="btn btn-default" href="{{ recharter_url }}">Recharter</a>
			{% endif %}
		{% endif %}
	{% endif %}
{% endif %}
</p>

<h2>Charter {{ doc.canonical_name }}-{{ doc.rev }}</h2>

{% if not snapshot and can_manage and chartering and group.state_id != "conclude" %}
	<p><a class="btn btn-default" href="{% url "charter_submit" name=doc.name %}">Change charter text</a></p>
{% endif %}

{% if doc.rev != "" %}
	{{ content|safe|keep_spacing|sanitize_html|wordwrap:80|safe }}
{% endif %}

{% if not snapshot and chartering %}
	<h2>Proposed milestones</h2>
	{% if can_manage %}
		<p><a class="btn btn-primary" href="{% url "group_edit_charter_milestones" group_type=doc.group.type_id acronym=doc.group.acronym %}">Edit milestones</a></p>
	{% endif %}

	{% if milestones %}
		{% include "group/milestones.html" %}
	{% else %}
		<p>No milestones for charter found.</p>
	{% endif %}
{% endif %}

{% endblock %}

