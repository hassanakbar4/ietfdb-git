{% extends "ietf.html" %}

{% load ietf_filters %}

{% block title %}{{ doc.name }}-{{ doc.rev }}{% endblock %}

{% block content %}
{{ top|safe }}

<ul class="pagination pagination-sm">
	<li class="disabled"><span><b>Snapshots</b></span></li>
	{% for rev in revisions %}
	<li {% if rev == doc.rev %}class="active"{% endif %}>
		<a href="{% url "doc_view" name=doc.name %}{{ rev }}/" >{{ rev }}</a>
	</li>
	{% endfor %}
</ul>

<table class="table table-condensed ietf">
	<tr>
		<th>
			{% if doc.get_state_slug not in approved_states %}
				Proposed conflict review
			{% else %}
				Conflict review
			{% endif %}
		</th>
		<td>
			<a href="{% url "doc_view" name=conflictdoc.canonical_name %}">
			{{ conflictdoc.canonical_name }}{% if conflictdoc.get_state_slug != 'rfc' %}-{{ conflictdoc.rev }}{% endif %}
			</a>
			<span class="label label-info">{{conflictdoc.stream}} stream</span>

			{% if snapshot %}
				<span class="label label-warning">Snapshot</span>
			{% endif %}
		</td>
	</tr>

	<tr>
		<th><a href="/doc/help/state/conflict-review/">Conflict review state</a></th>
		<td>
			{% if not snapshot and user|has_role:"Area Director,Secretariat" %}
				<a title="{{ doc.get_state.desc }}" class="editlink" href="{% url "conflict_review_change_state" name=doc.name %}">
			{% endif %}
			{{ doc.get_state.name }}
			{% if not snapshot and user|has_role:"Area Director,Secretariat" %}
				</a>
			{% endif %}

			{% if not snapshot and user|has_role:"Area Director,Secretariat" %}
				{% if request.user|has_role:"Secretariat" %}
					{% if doc.get_state_slug = 'appr-reqnopub-pend' or doc.get_state_slug = 'appr-noprob-pend' %}
						<a href="{% url "conflict_review_approve" name=doc.name %}">Approve conflict review</a>
					{% endif %}
				{% endif %}
			{% endif %}
		</td>
	</tr>

	{% if not snapshot %}
		<tr>
			<th>Telechat date</th>
			<td>
				{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
					<a class="editlink" href="{% url "conflict_review_telechat_date" name=doc.name %}">
				{% endif %}

				{% if not telechat %}
					Not on agenda of an IESG telechat
				{% else %}
					On agenda of {{ telechat.telechat_date|date:"Y-m-d" }} IESG telechat
					{% if doc.returning_item %} (returning item){% endif %}
				{% endif %}

				{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
					</a>
				{% endif %}

				{% if ballot_summary %}
					<div class="ballot-summary">{{ ballot_summary }}</div>
				{% endif %}
			</td>
		</tr>
	{% endif %}

	<tr>
		<th>Shepherding AD</th>
		<td>
			{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
				<a class="editlink" href="{% url "conflict_review_ad" name=doc.name %}">
			{% endif %}
			{{doc.ad}}
			{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
				</a>
			{% endif %}
		</td>
	</tr>

	<tr>
		<th>Send notices to</th>
		<td>
			{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
				<a class="editlink" href="{% url "conflict_review_notices" name=doc.name %}">
			{% endif %}
			{{doc.notify}}
			{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
				</a>
			{% endif %}
		</td>
	</tr>

	<tr>
		<th>Last updated</th>
		<td>{{ doc.time|date:"Y-m-d" }}</td>
	</tr>
</table>

</div>

<h2>Conflict review for {{ conflictdoc.name }}-{{ conflictdoc.rev }}</h2>
{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug != 'apprsent' %}
	<p><a class="btn btn-default" href="{% url "conflict_review_submit" name=doc.name %}">Change conflict review text</a></p>
{% endif %}

{% if doc.rev %}
{{ content|fill:"80"|safe|linebreaksbr|keep_spacing|sanitize_html|safe }}
{% endif %}

{% endblock %}

