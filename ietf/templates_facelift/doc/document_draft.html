{% extends "base.html" %}

{% load ietf_filters %}

{% block title %}
	{% if doc.get_state_slug == "rfc" %}
		RFC {{ rfc_number }}
	{% else %}
		{{ name }}-{{ doc.rev }}
	{% endif %}
{% endblock %}

{% block pagehead %}
<meta name="description" content="{{ doc.title }} {% if doc.get_state_slug == "rfc" %}(RFC {{ rfc_number }}{% if published %}, {{ published.time|date:"F Y" }}{% endif %}{% if obsoleted_by %}; obsoleted by {{ obsoleted_by|join:", " }}{% endif %}){% else %}(Internet-Draft, {{ doc.time|date:"Y" }}){% endif %}" />
{% endblock %}

{% block content %}
{{ top|safe }}

<table class="table table-condensed doc">
	<tr>
		<th>Document type</th>
		<td>
			{% if doc.get_state_slug == "rfc" %}
				RFC - {{ doc.std_level }}
				({% if published %}{{ published.time|date:"F Y" }}{% else %}publication date unknown{% endif %}{% if has_errata %}; <a href="http://www.rfc-editor.org/errata_search.php?rfc={{ rfc_number }}" rel="nofollow">Errata</a>{% endif %})

				{% if obsoleted_by %}<div>Obsoleted by {{ obsoleted_by|join:", "|urlize_ietf_docs }}</div>{% endif %}
				{% if updated_by %}<div>Updated by {{ updated_by|join:", "|urlize_ietf_docs }}</div>{% endif %}
				{% if obsoletes %}<div>Obsoletes {{ obsoletes|join:", "|urlize_ietf_docs }}</div>{% endif %}
				{% if updates %}<div>Updates {{ updates|join:", "|urlize_ietf_docs }}</div>{% endif %}
				{% if status_changes %}<div>Status changed by {{ status_changes|join:", "|urlize_ietf_docs }}</div>{% endif %}
				{% if proposed_status_changes %}<div>Proposed status changed by {{ proposed_status_changes|join:", "|urlize_ietf_docs }}</div>{% endif %}
				{% if rfc_aliases %}<div>Also Known As {{ rfc_aliases|join:", "|urlize_ietf_docs }}</div>{% endif %}
				{% if draft_name %}<div>Was <a href="/doc/{{ draft_name}}/">{{ draft_name }}</a> {% if submission %}({{ submission|safe }}){% endif %}</div>{% endif %}
			{% else %}
				{{ doc.get_state }} Internet-Draft {% if submission %}({{ submission|safe }}){% endif %}
				{% if resurrected_by %}- resurrect requested by {{ resurrected_by }}{% endif %}
			{% endif %}

			{% if replaces or can_edit_stream_info %}
				<div>
					{% if can_edit_stream_info %}
						<a href="{% url doc_change_replaces name=doc.name %}">
					{% endif %}
					Replaces
					{% if can_edit_stream_info %}
						<span class="glyphicon glyphicon-pencil"></span>
						</a>
					{% endif %}
					{{ replaces|join:", "|urlize_ietf_docs|default:"None" }}
				</div>
			{% endif %}

			{% if replaced_by %}<div>Replaced by: {{ replaced_by|join:", "|urlize_ietf_docs }}</div>{% endif %}
		</td>
	</tr>

	<tr>
		<th>Document stream</th>
		<td>
			{% if can_change_stream %}
				<a href="{% url doc_change_stream name=doc.name %}">
			{% endif %}
			{{ doc.stream|default:"No stream defined" }}
			{% if can_change_stream %}
				<span class="glyphicon glyphicon-pencil"></span>
				</a>
			{% endif %}
		</td>
	</tr>

	<tr>
		<th>Last updated</th>
		<td>
			{{ doc.time|date:"Y-m-d" }}
			{% if latest_revision and latest_revision.time.date != doc.time.date %}
				(latest revision {{ latest_revision.time|date:"Y-m-d" }})
			{% endif %}
		</td>
	</tr>

{% if doc.get_state_slug != "rfc" %}
	<tr>
		<th>Intended RFC status</th>
		<td>
			{% if can_edit or can_edit_stream_info %}
				<a href="{% url doc_change_intended_status name=doc.name %}">
			{% endif %}
			{{ doc.intended_std_level|default:"Unknown" }}
			{% if can_edit or can_edit_stream_info %}
				<span class="glyphicon glyphicon-pencil"></span>
				</a>
			{% endif %}
		</td>
	</tr>
{% endif %}

	<tr>
		<th>Other versions</th>
		<td>
			{% if doc.get_state_slug != "active" and doc.get_state_slug != "rfc" %}(expired, archived):{% endif %}
			{% if file_urls %}
				{% for label, url in file_urls %}
					<a href="{{ url }}">{{ label}}</a>{% if not forloop.last%}, {% endif %}
				{% endfor %}
			{% else %}
				(not online)
			{% endif %}
		</td>
	</tr>

{% if conflict_reviews %}
	<tr>
		<th>IETF conflict review</th>
		<td>{{ conflict_reviews|join:", "|urlize_ietf_docs }}</td>
	</tr>
{% endif %}

<tr><td colspan="2"><hr></td></tr>

<tr>
	{% if doc.stream %}
		<th>{{ doc.stream }} state</th>
		<td class="stream-state">
			{% if doc.stream and can_edit_stream_info %}
				<a href="{% url doc_change_stream_state name=doc.name state_type=stream_state_type_slug %}">
			{% endif %}
			{{ stream_state|default:"(None)" }}
			{% if doc.stream and can_edit_stream_info %}
				<span class="glyphicon glyphicon-pencil"></span>
				</a>
			{% endif %}

			{% for m in milestones %}
				<span title="{{ m.desc }} ({{ m.group.acronym }} milestone)" class="milestone">{{ m.due|date:"M Y" }}</span>
			{% endfor %}

			{% if stream_tags %}
				<div class="stream-tags">{% for tag in stream_tags %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</div>
			{% endif %}
		</td>
	{% else %}
		<th>Stream state</th><td>(No stream defined)</td>
	{% endif %}
</tr>

{% if consensus %}
	<tr>
		<th>Consensus</th>
		<td>
			<a title="Whether the document is the result of a community consensus process as defined in RFC 5741" {% if can_edit or can_edit_stream_info %}class="editlink" href="{% url doc_edit_consensus name=doc.name %}"{% endif %}>
			{{ consensus }}
			</a>
		</td>
	</tr>
{% endif %}

<tr>
	<th>Document shepherd</th>
	<td>
		{% if can_edit_stream_info %}
			<a href="{% url doc_edit_shepherd name=doc.name %}">
		{% endif %}
		{{ doc.shepherd|default:"No shepherd assigned" }}
		{% if can_edit_stream_info %}
			<span class="glyphicon glyphicon-pencil"></span>
			</a>
		{% endif %}
	</td>
</tr>

{% if shepherd_writeup or can_edit_shepherd_writeup %}
	<tr>
		<th>Shepherd write-up</th>
		<td>
			{% if can_edit_shepherd_writeup %}
				<a href="{% url doc_shepherd_writeup name=doc.name %}">
			{% endif %}
			{% if shepherd_writeup %}
				Last changed {{ shepherd_writeup.time|date:"Y-m-d"}}
			{% else %}
				(None)
			{% endif %}
			{% if can_edit_shepherd_writeup %}
				<span class="glyphicon glyphicon-pencil"></span>
				</a>
			{% endif %}
		</td>
	</tr>
{% endif %}

<tr><td colspan="2"><hr></td></tr>

{% if published and started_iesg_process and published.time < started_iesg_process.time %}
	<tr>
		<td colspan="2" class="warning">This information refers to IESG processing after the RFC was initially published:</td>
	</tr>
{% endif %}

<tr>
	<th><a href="{% url state_help "draft-iesg" %}">IESG state</a></th>
	<td>
		{% if iesg_state and can_edit %}
			<a href="{% url doc_change_state name=doc.name %}">
		{% endif %}
		{{ iesg_state_summary|default:"I-D Exists" }}
		{% if iesg_state and can_edit %}
			<span class="glyphicon glyphicon-pencil"></span>
			</a>
		{% endif %}

		{% if iana_review_state %}
			<div>
				IANA review state:
				{% if can_edit_iana_state %}
					<a href="{% url doc_change_iana_state name=doc.name state_type="iana-review" %}">
				{% endif %}
				{{ iana_review_state }}
				{% if can_edit_iana_state %}
					<span class="glyphicon glyphicon-pencil"></span>
					</a>
				{% endif %}
			</div>

			<div>
				IANA action state:
				{% if can_edit_iana_state %}
					<a href="{% url doc_change_iana_state name=doc.name state_type="iana-action" %}">
				{% endif %}
				{{ iana_action_state }}
				{% if can_edit_iana_state %}
					<span class="glyphicon glyphicon-pencil"></span>
					</a>
				{% endif %}
			</div>
		{% endif %}

		{% if rfc_editor_state %}
			<div>
				RFC Editor state:
				<a href="http://www.rfc-editor.org/queue2.html#{{ doc.name }}">{{ rfc_editor_state }}</a>
			</div>
		{% endif %}

		<div class="telechat">
			{% if can_edit %}
				<a href="{% url doc_change_telechat_date name=doc.name %}">
			{% endif %}
			{% if telechat %}
				On agenda of {{ telechat.telechat_date }} IESG telechat
				{% if telechat.returning_item %}
					(returning item)
				{% endif %}
			{% else %}
				{% if can_edit %}
					Not on an upcoming telechat agenda
				{% endif %}
			{% endif %}
			{% if can_edit %}
				<span class="glyphicon glyphicon-pencil"></span>
				</a>
			{% endif %}
		</div>

		{% if ballot_summary %}
			<div class="ballot-summary"><i>({{ ballot_summary }})</i></div>
		{% endif %}
	</td>
</tr>

<tr>
	<th>Responsible AD</th>
	<td>
		{% if can_edit %}
			<a href="{% url doc_change_ad name=doc.name %}">
		{% endif %}
		{{ doc.ad|default:"(None)" }}
		{% if can_edit %}
			<span class="glyphicon glyphicon-pencil"></span>
			</a>
		{% endif %}
	</td>
</tr>

{% if iesg_state %}
	{% if doc.note or can_edit %}
		<tr>
			<th>IESG note</th>
			<td>
				{% if can_edit %}
					<a href="{% url doc_change_iesg_note name=doc.name %}">
				{% endif %}
				{{ doc.note|default:"(None)"|linebreaksbr }}
				{% if can_edit %}
					<span class="glyphicon glyphicon-pencil"></span>
					</a>
				{% endif %}
			</td>
		</tr>
	{% endif %}
{% endif %}

<tr>
	<th>Send notices to</th>
	<td>
		{% if can_edit %}
			<a href="{% url doc_change_notify name=doc.name %}">
		{% endif %}
		{{ doc.notify|default:"No addresses provided"}}
		{% if can_edit %}
			<span class="glyphicon glyphicon-pencil"></span>
			</a>
		{% endif %}
	</td>
</tr>
</table>

<p class="buttonlist">
	<a class="btn btn-default btn-xs" href="mailto:{{ doc.name }}@tools.ietf.org?subject=Mail%20regarding%20{{ doc.name }}" rel="nofollow">Email authors</a>
	<a class="btn btn-default btn-xs" href="{% url ipr_search %}?option=document_search&amp;id={{ doc.name }}" rel="nofollow">IPR{% if doc.related_ipr %} ({{doc.related_ipr|length}}){% endif %}</a>
	<a class="btn btn-default btn-xs" href="http://www.fenron.net/~fenner/ietf/deps/index.cgi?dep={{ name }}" rel="nofollow">Dependencies</a>
	<a class="btn btn-default btn-xs" href="{% url doc_references doc.canonical_name %}" rel="nofollow">References</a>
	<a class="btn btn-default btn-xs" href="{% url doc_referenced_by doc.canonical_name %}" rel="nofollow">Referenced by</a>
	<a class="btn btn-default btn-xs" href="http://tools.ietf.org/idnits?url=http://tools.ietf.org/id/{{ doc.filename_with_rev }}" rel="nofollow" target="_blank">Nits</a>
	<a class="btn btn-default btn-xs" href="/feed/document-changes/{{ name }}/">History</a>
	<a class="btn btn-default btn-xs" href="http://www.google.com/search?as_q={{ doc.name }}&amp;as_sitesearch={{ search_archive }}" rel="nofollow" target="_blank">Search lists</a>
	{% if user|has_role:"Area Director" %}
		<a class="btn btn-default btn-xs" href="https://www.iesg.org/bin/c5i?mid=6&amp;rid=77&amp;target={{ doc.name }}" rel="nofollow" target="_blank">Search lists (ARO)</a>
	{% endif %}
	{% if show_add_to_list and user.is_authenticated %}
		<a class="btn btn-default btn-xs"  href="{% url community_add_document doc.name %}" title="Add to your personal ID list">Track</a>
	{% endif %}

	{% if can_edit and iesg_state %}
		<a class="btn btn-default btn-xs" href="{% url doc_ballot_lastcall name=doc.name %}">Last call text</a>
		<a class="btn btn-default btn-xs" href="{% url doc_ballot_writeupnotes name=doc.name %}">Ballot text</a>
		<a class="btn btn-default btn-xs" href="{% url doc_ballot_approvaltext name=doc.name %}">Announcement text</a>
	{% endif %}

	{% if actions %}
		{% for label, url in actions %}
			<a class="btn btn-primary btn-xs" href="{{ url }}">{{ label|capfirst }}</a>
		{% endfor %}
	{% endif %}
</p>

{% if doc.get_state_slug == "active" or doc.get_state_slug == "rfc" %}
	<div class="document-markup">
		{{ content|safe }}
	</div>

	{% if split_content %}
		<a class="btn btn-default btn-block" href="?include_text=1">Include full document text</a>
	{% endif %}

{% else %}
	<p></p>
	<div class="panel panel-warning">
		<div class="panel-heading">
			This Internet-Draft is no longer active. Unofficial copies of old Internet-Drafts can be found at <a href="http://tools.ietf.org/id/{{ doc.name }}">http://tools.ietf.org/id/{{ doc.name }}</a>
		</div>
		<div class="panel-body">
			<h4>Abstract</h4>
			<p>{{ doc.abstract|escape }}</p>

			<h4>Authors</h4>
			<p>
			{% for author in doc.documentauthor_set.all %}
				<a {% if not author.author.invalid_address %}href="mailto:{{ author.author.address }}"{% endif %}>{{ author.author.person }} {% if not author.author.invalid_address %}&lt;{{ author.author.address }}&gt;{% endif %}</a>
				{% if not forloop.last %}<br/>{% endif %}
			{% endfor %}
			</p>
			<p>(Note: The e-mail addresses provided for the authors of this Internet-Draft may no longer be valid)</p>
		</div>
	</div>
{% endif %}

{% endblock %}
