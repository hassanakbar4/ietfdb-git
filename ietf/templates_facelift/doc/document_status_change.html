{% extends "ietf.html" %}

{% load ietf_filters %}

{% block title %}{{ doc.canonical_name }}-{{ doc.rev }}{% endblock %}

{% block content %}
{{ top|safe }}

<ul class="pagination pagination-sm">
	<li class="disabled"><span><b>Snapshots</b></span></li>
	{% for rev in revisions %}
	<li {% if rev == doc.rev %}class="active"{% endif %}>
		<a href="{% url "doc_view" name=doc.name %}{{ rev }}/">{{ rev }}</a>
	</li>
	{% endfor %}
</ul>

<table class="table table-condensed table-striped">
	<tr>
		<th>
			{% if doc.get_state_slug not in approved_states %}
				Proposed status change
			{% else %}
				Status change
			{% endif %}
		</th>
		<td>
			{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
				<a class="btn btn-default btn-xs pull-right" href="{% url "status_change_title" name=doc.name %}">Edit</a>
			{% endif %}
			{{ doc.title }}
			{% if snapshot %}
				<span class="label label-warning">Snapshot</span>
			{% endif %}
		</td>
	</tr>

	{% regroup sorted_relations by relationship.name as relation_groups %}
	{% for relation_group in relation_groups %}
		<tr>
			<th>{{relation_group.grouper}}</th>
			<td>{% for rel in relation_group.list %}{{rel.target.document.canonical_name|upper|urlize_ietf_docs}}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
		</tr>
	{% endfor %}

	<tr>
		<th><a href="{% url "state_help" type="status-change" %}">Review state</a></th>

		<td>
			{% if not snapshot and user|has_role:"Area Director,Secretariat" %}
				<a class="btn btn-default btn-xs pull-right" href="{% url "status_change_change_state" name=doc.name %}">Edit</a>
			{% endif %}
			<span title="{{ doc.get_state.desc }}">{{ doc.get_state.name }}</span>
		</td>
	</tr>

	<tr>
		<th>Telechat date</th>
		<td>
			{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
				<a class="btn btn-default btn-xs pull-right" href="{% url "status_change_telechat_date" name=doc.name %}">Edit</a>
			{% endif %}
			{% if not telechat %}
				(None)
			{% else %}
				On agenda of {{ telechat.telechat_date|date:"Y-m-d" }} IESG telechat
				{% if doc.returning_item %}(returning item){% endif %}
			{% endif %}

			{% if ballot_summary %}
				<br><i>{{ ballot_summary }}</i>
			{% endif %}
		</td>
	</tr>

	<tr>
		<th>Shepherding AD</th>
		<td>
			{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
				<a class="btn btn-default btn-xs pull-right" href="{% url "status_change_ad" name=doc.name %}">Edit</a>
			{% endif %}
			{{doc.ad}}
		</td>
	</tr>

	<tr>
		<th>Send notices to</th>
		<td>
			{% if not snapshot and user|has_role:"Area Director,Secretariat" and doc.get_state_slug not in approved_states %}
				<a class="btn btn-default btn-xs pull-right" href="{% url "status_change_notices" name=doc.name %}">Edit</a>
			{% endif %}
			{{doc.notify}}
		</td>
	</tr>

	<tr>
		<th>Last updated</th>
		<td>{{ doc.time|date:"Y-m-d" }}</td>
	</tr>
</table>

<p class="buttonlist">
	{% if not snapshot and user|has_role:"Area Director,Secretariat" %}
		{% if doc.get_state_slug not in approved_states %}
			<a class="btn btn-default" href="{% url "status_change_relations" name=doc.name %}">Edit affected RFCs</a>
			<a class="btn btn-default" href="{% url "status_change_last_call"  name=doc.name %}">Edit last call text</a>
		{% endif %}

		{% if doc.get_state_slug != 'apprsent' %}
			<a class="btn btn-default" href="{% url "status_change_submit" name=doc.name %}">Edit status change text</a>
		{% endif %}
	{% endif %}

	{% if request.user|has_role:"Secretariat" and doc.get_state_slug = 'appr-pend' %}
				<a class="btn btn-warning" href="{% url "status_change_approve" name=doc.name %}">Approve RFC status change</a>
	{% endif %}
</p>

{% if doc.rev %}
	{{ content|fill:"80"|safe|linebreaksbr|keep_spacing|sanitize_html|safe }}
{% endif %}

{% endblock %}

