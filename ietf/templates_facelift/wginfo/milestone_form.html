{# assumes group, form, needs_review are in the context #}

{% load widget_tweaks %}

<!-- Modal -->
<div class="modal fade" id="{{form.prefix|default:'addmilestone'}}" tabindex="-1" role="dialog" aria-labelledby="{{form.prefix}}" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="myModalLabel">{{ action|capfirst }} milestone</h4>
			</div>
			<div class="modal-body">
				<input type="hidden" name="prefix" value="{{ form.prefix|default:'' }}">
				{{ form.id }}

				<div class="form-group">
					<label class="col-sm-2 control-label">Milestone</label>
					<div class="col-sm-10">
						{% if needs_review and form.milestone and form.milestone.state_id != "review" %}
							{{ form.milestone.desc|add_class:"form-control" }}
							{{ form.desc.as_hidden|add_class:"form-control" }}
							{{ form.desc.errors|add_class:"form-control" }}
						{% else %}
							{{ form.desc|add_class:"form-control" }}
						{% endif %}
					</div>
				</div>

				{{ form.delete|add_class:"hidden" }}

				<div class="form-group">
					<label class="col-sm-2 control-label">Due date</label>
					<div class="col-sm-10">
						<div class="row">
							<div class="col-sm-6">
								{{ form.due_month|add_class:"form-control" }}
							</div>
							<div class="col-sm-6">
								{{ form.due_year|add_class:"form-control" }}
							</div>
						</div>

						{{ form.due_month.errors|add_class:"form-control" }}
						{{ form.due_year.errors|add_class:"form-control" }}
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">Drafts</label>
					<div class="col-sm-10">
						<input name="{{ form.docs.html_name }}" class="tokenized-field" data-ajax-url="{% url "wg_ajax_search_docs" group.acronym %}" data-pre="{{ form.docs_prepopulate }}">
						{{ form.docs.errors|add_class:"form-control" }}
					</div>
				</div>

				{% if form.needs_review %}
					<div class="form-group">
						<label class="col-sm-2 control-label">Review</label>
						<div class="col-sm-10">
							<p class="form-control-static">
							This milestone is not active yet; awaiting
							AD acceptance{% if needs_review %}.</p>{% else %}:</p> {{ form.accept }}{% endif %}
						</div>
					</div>
				{% endif %}

			</div>
			<div class="modal-footer">
				{% if action == "edit" %}
					<button type="button" class="btn btn-danger pull-left" data-dismiss="modal">Delete milestone</button>
				{% endif %}
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				<button type="submit" class="btn btn-primary">Save changes</button>
			</div>
		</div>
	</div>
</div>
