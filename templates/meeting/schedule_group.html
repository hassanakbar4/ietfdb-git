{# Copyright The IETF Trust 2007, All Rights Reserved #}
{% extends "base.html" %}

{% block title %}IETF Meeting Session Request Tool{% endblock %}

{% block css %}
{% endblock %}

{% block head %}

<link rel="stylesheet" type="text/css" href="https://www.ietf.org/css/base.css" />

<script language="javascript">

window.onload = function()
{
    var num_session = document.getElementById('id_num_session');
    var length_session1 = document.getElementById('id_length_session1');
    var length_session2 = document.getElementById('id_length_session2');
    var length_session3 = document.getElementById('id_length_session3');
    var arrWorkGroups = document.getElementsByName("work_groups");

    // Assign event handlers
    num_session.onchange = function()
    {
        var objSelect = num_session;
        var sessions = parseInt(objSelect.options[objSelect.selectedIndex].value);
        var form = objSelect.form;

        if (sessions == 0)
        {
            form.length_session1.disabled = true;
            form.length_session2.disabled = true;
            form.length_session3.disabled = true;
            form.length_session1.value = 0;
            form.length_session2.value = 0;
            form.length_session3.value = 0;
            form.third_session.disabled = true;
            form.third_session.checked = false;
        }
        else if (sessions == 1)
        {
            form.length_session1.disabled = false;
            form.length_session2.disabled = true;
            form.length_session3.disabled = true;
            form.length_session2.value = 0;
            form.length_session3.value = 0;
            form.third_session.disabled = true;
            form.third_session.checked = false;
        }
        else if (sessions == 2)
        {
           form.third_session.disabled = false;
           form.length_session1.disabled = false;
           form.length_session2.disabled = false;
        }
    }

    for (var i = 0; i < arrWorkGroups.length; i++)
    {
        var workgroup = arrWorkGroups[i];
        workgroup.indexnum = i;
        workgroup.onchange = function (e)
        {
           if ( ! e ) e = window.event;
           var objSelect = e.target ? e.target : e.srcElement;
           var acronym = objSelect.options[objSelect.selectedIndex].text;
           var Priority = document.getElementById('id_conflict' + (objSelect.indexnum + 1));
           if (objSelect.selectedIndex > 0) {
             Priority.value = Priority.value + ( Priority.value ? ' ' : '' ) + acronym;
             objSelect.selectedIndex = 0;
           }
           return handleconflictfield(objSelect.indexnum + 1)
        }
    }

    num_session.onchange();
}

function delete_last(id)
{
   var TextInput = document.getElementById(id);
   TextInput.value = TextInput.value.replace(/ *[0-9A-z]+$/, '');
}

function handleconflictfield (val)
{

  var form_post = document.forms[1];

  if (val==1) {
    if (form_post.conflict1.value.length > 0) {
       form_post.conflict2.disabled=false;
       if (form_post.conflict2.value.length > 0) {
         form_post.conflict3.disabled=false;
       }
       return 1;
    } else {
       if (form_post.conflict2.value.length > 0 || form_post.conflict3.value.length > 0) {
         alert("Second and Third Conflicts to Avoid fields are being disabled");
         form_post.conflict2.disabled=true;   
         form_post.conflict3.disabled=true;   
         return 0;
       }
    }
  } else {
    if (form_post.conflict2.value.length > 0) {
       form_post.conflict3.disabled=false;
       return 1;
    } else {
       if (form_post.conflict3.value.length > 0) {
         alert("Third Conflicts to Avoid field is being disabled");
         form_post.conflict3.disabled=true;   
         return 0;
       }
    }
  }
  return 1; 
}

function retrieve_data()
{
  var form_post = document.forms[1];

  form_post.num_session.selectedIndex = last_session.num_session;
  form_post.length_session1.selectedIndex = last_session.length_session1-1;
  form_post.length_session2.selectedIndex = last_session.length_session2-1;
  form_post.length_session3.selectedIndex = last_session.length_session3-1;
  form_post.number_attendee.value = last_session.number_attendee;
  form_post.conflict1.value = last_session.conflict1;
  form_post.conflict2.value = last_session.conflict2;
  form_post.conflict3.value = last_session.conflict3;
  form_post.conflict_other.value = last_session.conflict_other;
  form_post.special_req.value = last_session.special_req;
  if (last_session.num_session == 1) {
    form_post.length_session2.disabled=true;
    form_post.length_session3.disabled=true;
  }
}

{% if last_session %}
var last_session = {
  'num_session': {{last_session.num_session|default:1}},
  'length_session1': {{last_session.length_session1.hour_id|default:0}},
  'length_session2': {{last_session.length_session2.hour_id|default:0}},
  'length_session3': {{last_session.length_session3.hour_id|default:0}},
  'number_attendee':{{last_session.number_attendee}},
  'conflict1': '{{last_session.conflict1}}',
  'conflict2': '{{last_session.conflict2}}',
  'conflict3': '{{last_session.conflict3}}',
  'conflict_other': '{{last_session.conflict_other}}',
  'special_req': '{{last_session.special_req}}'
};
{% else %}
var last_session = false;
{% endif %}

</script>

{% endblock %}

{% block content %}
<p>
<blockquote>
<h2><center>IETF Meeting Session Request Tool</center></h2>

<h2>IETF {{meeting_num}}: {% if is_new %}Request New Session{% else %}Edit/Cancel Previously Requested Session{% endif %}</h2>
<hr>
</p>

{% if is_new %}
<form method="post">
{{meetingform.group_acronym_id}}
<input type="submit" name="not_meeting" value="Send a notification that the group does not plan to hold a session at IETF {{meeting_num}}" onClick="return window.confirm('A message will be sent to agenda@ietf.org as well as to the Operations and Management Area director(s).\n\nContinue?');">
</form>
{% endif %}

<br/>
{% if last_session %}
<input type="button" value="Retrieve all Information from previous meeting" onclick="retrieve_data()"><br/><br/>
{% endif %}

<font color="red"><b>*</b></font> Required field.

<form name="post_form" method="post">

{{meetingform.session_id}}
{{meetingform.group_acronym_id}}

<table cellpadding="1" cellspacing="1" border="0" width="800">

<tr bgcolor="#cccccc"><td width="200">Working Group Name: </td><td>{{group.group_acronym.name}} ({{group.group_acronym.acronym}})</td></tr>
<tr bgcolor="#eeeeee"><td>Area Name: </td><td>{{group.area.area.area_acronym.name}} ({{group.area.area.area_acronym.acronym}}) </td></tr>
<tr bgcolor="#cccccc"><td>Number of Sessions: <font color="red"><b>*</b></font></td><td>{{meetingform.num_session}} {% if meetingform.num_session.errors %}<font color="red">{{meetingform.num_session.errors.as_text}}</font>{% endif %}</td></tr>

<tr bgcolor="#eeeeee"><td>Length of Session 1: <font color="red"><b>*</b></font> </td><td>{{meetingform.length_session1}} {% if meetingform.length_session1.errors %}<font color="red">{{meetingform.length_session1.errors.as_text}}</font>{% endif %}</td></tr>
<tr bgcolor="#eeeeee"><td>Length of Session 2: <font color="red"><b>*</b></font> </td><td>{{meetingform.length_session2}}</td></tr>

<tr bgcolor="#eeeeee" valign="top"><td>Additional Session Request:</td><td><input type="checkbox" name="third_session" onchange="this.form.length_session3.disabled = (this.checked == false)"{% ifequal meetingform.num_session, 3 %} checked="checked"{% endifequal %}> Check this box to request an additional session.<br>

Additional slot may be available after agenda scheduling has closed and with the approval of an Area Director.<br>
Length of third session:
{{meetingform.length_session3}} {% if meetingform.length_session3.errors %}<font color="red">{{meetingform.length_session3.errors.as_text}}</font>{% endif %}
</td></tr>

<tr bgcolor="#cccccc"><td>Number of Attendees: <font color="red"><b>*</b></font> </td><td>{{meetingform.number_attendee}} {% if meetingform.number_attendee.errors %}<font color="red">{{meetingform.number_attendee.errors.as_text}}</font>{% endif %}</td></tr>

<tr bgcolor="#eeeeee"><td valign="top">Conflicts to Avoid:</td>
<td>


    <table border="0">
    <tr><td colspan="2">Other WGs that included {{group.group_acronym.acronym}} in their conflict lists:</td>
    <td>
{% if conflicts %}
{% for conflict in conflicts %}
{{conflict.group_acronym.acronym}}{% if not forloop.last %},{% endif %}
{% endfor %}
{% else %}
<i>None so far</i>
{% endif %}
    </td></tr>
    <tr bgcolor="#cccccc"><td rowspan="3" valign="top" width="220">WG Sessions:<br>You may select multiple WGs within each priority</td><td width="320">First Priority: </td>
    <td>
    {{meetingform.work_groups}}
    <input type="button" value="Delete the last entry" onClick="delete_last('id_conflict1'); return handleconflictfield(1);"><br>
    {{meetingform.conflict1}}
    {% if meetingform.conflict1.errors %}<font color="red">{{meetingform.conflict1.errors.as_text}}</font>{% endif %}
    </td>
    </tr>

    <tr bgcolor="#cccccc"><td>Second Priority: </td><td>
    {{meetingform.work_groups}}
    <input type="button" value="Delete the last entry" onClick="delete_last('id_conflict2'); return handleconflictfield(2);"><br>
    {{meetingform.conflict2}}
    {% if meetingform.conflict2.errors %}<font color="red">{{meetingform.conflict2.errors.as_text}}</font>{% endif %}


    <tr bgcolor="#cccccc">
    <td>Third Priority: </td><td>
    {{meetingform.work_groups}}
    <input type="button" value="Delete the last entry" onClick="delete_last('id_conflict3'); return handleconflictfield(3);"><br>
    {{meetingform.conflict3}}
    {% if meetingform.conflict3.errors %}<font color="red">{{meetingform.conflict3.errors.as_text}}</font>{% endif %}

    </td></tr>
    <tr><td colspan="2">BOF or IRTF Sessions:<br>(Please enter free-form text) </td>
    <td>{{meetingform.conflict_other}}</td></tr>
    </table>

</td>
</tr>

<tr bgcolor="#cccccc"><td valign="top">Special Requests:</td>
<td>
{{meetingform.special_req}}
</td>
</tr>

</table>

<input name="save" type="submit" value="Continue to Confirmation Page">
<input type="reset" value="Reset the Form">

</form>

{% endblock %}
{% block local_footer %}
{% include "meeting/local_footer.html" %}
{% endblock %}
